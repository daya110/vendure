<vdr-action-bar>
    <vdr-ab-left>
        <clr-dropdown>
            <button type="button" class="btn btn-outline-primary" clrDropdownTrigger>
                <clr-icon shape="world"></clr-icon>
                {{ 'common.language' | translate }}: {{ languageCode$ | async | uppercase }}
                <clr-icon shape="caret down"></clr-icon>
            </button>
            <clr-dropdown-menu clrPosition="bottom-right" *clrIfOpen>
                <button type="button"
                        *ngFor="let code of availableLanguages$ | async"
                        (click)="setLanguage(code)"
                        clrDropdownItem>{{ code }}</button>
            </clr-dropdown-menu>
        </clr-dropdown>
    </vdr-ab-left>


    <vdr-ab-right>
        <button class="btn btn-primary"
                *ngIf="isNew$ | async; else updateButton"
                (click)="create()"
                [disabled]="productForm.invalid || productForm.pristine">{{ 'common.create' | translate }}</button>
        <ng-template #updateButton>
            <button class="btn btn-primary"
                    (click)="save()"
                    [disabled]="productForm.invalid || productForm.pristine">{{ 'common.update' | translate }}</button>
        </ng-template>
    </vdr-ab-right>
</vdr-action-bar>

<form class="form" [formGroup]="productForm" >
    <section class="form-block" formGroupName="product">
        <label>{{ 'catalog.product' | translate }}</label>
        <vdr-form-field [label]="'catalog.product-name' | translate" for="name">
            <input id="name" type="text" formControlName="name" (input)="updateSlug($event.target.value)">
        </vdr-form-field>
        <vdr-form-field [label]="'catalog.slug' | translate" for="slug">
            <input id="slug" type="text" formControlName="slug">
        </vdr-form-field>
        <vdr-form-field [label]="'catalog.description' | translate" for="description">
            <textarea id="description" formControlName="description"></textarea>
        </vdr-form-field>
    </section>

    <section class="form-block" *ngIf="!(isNew$ | async)">


        <label>{{ 'catalog.product-variants' | translate }}</label>

        <div *ngIf="(variants$ | async)?.length === 0; else variants">
            <clr-dropdown>
                <button type="button" class="btn btn-primary" clrDropdownTrigger>
                    <clr-icon shape="add"></clr-icon>
                    {{ 'catalog.generate-product-variants' | translate }}
                    <clr-icon shape="caret down"></clr-icon>
                </button>
                <clr-dropdown-menu clrPosition="bottom-right" *clrIfOpen>
                    <button type="button"
                            clrDropdownItem
                            (click)="generateProductVariants()">{{ 'catalog.generate-variants-default-only' | translate }}</button>
                    <button type="button"
                            clrDropdownItem
                            (click)="startProductVariantsWizard()">{{ 'catalog.generate-variants-with-options' | translate }}</button>
                </clr-dropdown-menu>
            </clr-dropdown>

            <vdr-product-variants-wizard #productVariantsWizard
                                         [product]="product$ | async"></vdr-product-variants-wizard>
        </div>

        <ng-template #variants>
            <vdr-form-item [label]="'catalog.product-option-groups' | translate">
                <div class="option-groups-list">
                    <div *ngFor="let optionGroup of (product$ | async)?.optionGroups"
                         class="option-group">
                        <vdr-chip>{{ optionGroup.name }} ({{ optionGroup.code }})</vdr-chip>
                    </div>
                </div>
            </vdr-form-item>

            <table class="variants-list table" formArrayName="variants">
                <thead>
                <tr>
                    <th>{{ 'catalog.product-variant-table-sku' | translate }}</th>
                    <th>{{ 'catalog.product-variant-table-name' | translate }}</th>
                    <th>{{ 'catalog.product-variant-table-options' | translate }}</th>
                    <th>{{ 'catalog.product-variant-table-price' | translate }}</th>
                </tr>
                </thead>
                <tbody>
                <tr class="variant"
                    *ngFor="let variant of variants$ | async; let i = index"
                    [formGroupName]="i">
                    <td>
                        <input type="text" formControlName="sku">
                    </td>
                    <td>
                        <input type="text" formControlName="name">
                    </td>
                    <td>
                        <vdr-chip *ngFor="let option of variant.options">{{ option.name }}</vdr-chip>
                    </td>
                    <td>
                        <vdr-currency-input formControlName="price"></vdr-currency-input>
                    </td>
                </tr>
                </tbody>
            </table>
        </ng-template>

    </section>

</form>
